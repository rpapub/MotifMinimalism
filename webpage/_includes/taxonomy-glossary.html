{% assign glossary_title = include.title | default: "Glossary" %}
{% assign type_filter = include.types | default: nil %}

{% assign entries_unsorted = site.data.taxonomy %}
{% assign entries_sorted = entries_unsorted | sort: "title" %}
{% assign entries_filtered = "" | split: "" %}

{% for item in entries_sorted %}
  {% if item.ID and item.title %}
    {% assign entries_filtered = entries_filtered | push: item %}
  {% endif %}
{% endfor %}

{% if type_filter %}
  {% assign entries_filtered_typed = "" | split: "" %}
  {% for item in entries_filtered %}
    {% if type_filter contains item.Type %}
      {% assign entries_filtered_typed = entries_filtered_typed | push: item %}
    {% endif %}
  {% endfor %}
  {% assign entries = entries_filtered_typed %}
{% else %}
  {% assign entries = entries_filtered %}
{% endif %}


<div class="wa-stack wa-gap-2xl">
  <h2>Runtime Constructs Glossary</h2>
  <dl class="wa-stack wa-gap-2xl">
    {% for item in entries %}
      <div class="wa-grid wa-gap-xs">
        <dt class="wa-heading-m">{{ item.title }}</dt>
        <dd>
          {% if item.description %}
            {{ item.description }}
          {% elsif item.related %}
            {% assign ref = site.data.taxonomy | where: "ID", item.related | first %}
            See: <strong>{{ ref.title }}</strong>{% if item.relatedtype %} ({{ item.relatedtype }}){% endif %}
          {% else %}
            <em>No description available.</em>
          {% endif %}

          {% if item.crossref %}
            {% assign parent = site.data.taxonomy | where: "ID", item.crossref | first %}
            <br><small><em>Part of: {{ parent.title }}</em></small>
          {% endif %}
        </dd>
      </div>
      {% unless forloop.last %}
        <wa-divider></wa-divider>
      {% endunless %}
    {% endfor %}
  </dl>
</div>
